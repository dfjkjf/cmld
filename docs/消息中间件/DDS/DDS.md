---
sort: 1
---

# DDS


规范主体部分详细介绍了数据分发服务（DDS）的核心概念和组件。以下是规范主体部分的详细大纲：

1. 概述
   - 介绍DDS的基本目的和功能。
   - 阐述DDS如何支持分布式应用通信和集成。

2. 目的
   - 描述DDS旨在解决的具体需求，包括高效的数据分发和资源的高效使用。
   - 讨论DDS的预期应用领域，如实时系统、工业自动化、网络管理和电信设备控制等。

3. 数据中心发布-订阅（DCPS）模型
   - 定义DCPS模型，包括出版者（Publisher）、订阅者（Subscriber）和数据写入者（DataWriter）/数据读取者（DataReader）的角色。
   - 介绍如何通过主题（Topic）进行数据发布和订阅。
   - 讨论数据模型和全球数据空间的概念。

4. 平台独立模型（PIM）
   - 描述PIM的架构和设计原理。
   - 详细介绍PIM中的类和接口，包括实体（Entity）、域参与者（DomainParticipant）、主题（Topic）、出版者（Publisher）、数据写入者（DataWriter）和订阅者（Subscriber）等。
   - 讨论PIM中的QoS（服务质量）策略和它们如何影响服务行为。

5. 平台特定模型（PSM）
   - 解释PIM到PSM的映射规则，包括如何将UML接口和类映射到IDL接口。
   - 讨论PSM中的数据类型、错误返回值和特定于平台的类型。

6. 交互模型
   - 描述DDS的发布和订阅交互模型。
   - 介绍使用监听器和条件/等待集的机制来异步通知应用程序关于通信状态的变化。

7. 内置主题
   - 介绍DDS内置主题的概念，这些主题用于传播关于远程实体（如参与者、主题和数据写入者）的信息。
   - 讨论如何通过内置DataReader对象访问内置主题。

8. 监听器、条件和等待集
   - 详细介绍监听器和条件的使用方法，以及如何通过等待集同步或异步地等待特定条件的发生。
   - 讨论各种通信状态变化的监听和处理。

9. QoS（服务质量）支持
   - 详细说明DDS支持的各种QoS策略，包括持久性（Durability）、呈现（Presentation）、可靠性（Reliability）等。
   - 讨论如何通过QoS策略配置DDS实体的行为。

规范主体部分为开发者提供了实现和使用DDS所需的详细信息，包括如何创建和管理DDS实体、如何配置和使用QoS策略，以及如何处理DDS中的各种通信状态和事件。


## 功能

DDS（Data Distribution Service）的基本目的和功能是提供一个高效、可靠且可扩展的通信框架，用于分布式系统中的数据共享和集成。以下是DDS的一些核心功能和目标：
- 数据集成：DDS旨在简化分布式应用中的数据集成，通过提供一种机制来分发和共享数据，从而使得不同的系统组件能够无缝地交换信息。
- 实时性能：DDS专注于支持实时应用的需求，确保数据的及时分发和处理，满足严格的时间约束。
- 高效数据分发：DDS通过使用发布-订阅模型，允许数据生产者（Publishers）发布数据，而数据消费者（Subscribers）可以订阅感兴趣的数据，从而实现高效的数据分发。
- 解耦合通信：DDS支持发布者和订阅者之间的解耦合通信，这意味着它们不需要直接知道对方的存在，而是通过中间件（即DDS）进行通信。
- QoS（服务质量）支持：DDS提供了一套QoS策略，允许开发者根据应用需求配置数据传输的可靠性、持久性、传输延迟等参数。
- 数据本地化：DDS支持数据本地化，即数据可以在本地节点上被访问和处理，减少了网络传输的需要，提高了效率。
- 动态拓扑：DDS允许动态地添加或移除参与者，而不会中断系统的运行，支持系统的可扩展性和灵活性。
- 多供应商互操作性：DDS规范旨在确保不同供应商实现的DDS产品能够相互操作，从而促进了技术的广泛采用和生态系统的建立。
- 通过这些功能和目标，DDS为分布式系统提供了一个坚实的中间件基础，使得开发者能够构建复杂、高效且可靠的实时数据交换应用。


## 使用

如何通过主题（Topic）进行数据发布和订阅？

在DDS（Data Distribution Service）中，主题（Topic）是数据发布和订阅的核心概念，它定义了数据的类型和内容，允许发布者（Publishers）和订阅者（Subscribers）之间进行数据交换。以下是通过主题进行数据发布和订阅的过程：

1. **定义数据类型**：
   - 在创建主题之前，必须先定义将要发布的数据的类型。这通常通过使用IDL（Interface Definition Language）来完成，IDL定义了数据的结构，然后通过DDS的类型支持机制（TypeSupport）将其注册到DDS系统中。

2. **创建主题**：
   - 发布者通过域参与者（DomainParticipant）创建主题。创建主题时，需要指定主题的名称、与主题关联的数据类型，以及相关的QoS策略。这些QoS策略可能包括持久性、可靠性、传输延迟等。

3. **创建发布者和数据写入者**：
   - 发布者负责管理数据写入者（DataWriters）。每个数据写入者都与特定的数据类型相关联，并且负责将数据实例发布到主题上。发布者可以创建一个或多个数据写入者，以便发布不同类型的数据。

4. **发布数据**：
   - 数据写入者使用写（write）或写带时间戳（write_w_timestamp）操作将数据实例发布到主题。这些操作允许发布者将数据发送到DDS系统，从而使得订阅者可以接收到这些数据。

5. **创建订阅者和数据读取者**：
   - 订阅者通过域参与者创建，并指定其感兴趣的主题。订阅者可以创建一个或多个数据读取者（DataReaders），以便从主题接收数据。

6. **订阅主题**：
   - 数据读取者订阅主题，以便接收与主题关联的数据。订阅者可以通过读取（read）或获取（take）操作从数据读取者接收数据，这些操作允许订阅者获取最新的数据实例。

7. **接收数据**：
   - 当发布者发布数据到主题时，DDS系统负责将数据分发给所有匹配的订阅者。订阅者可以通过轮询（polling）数据读取者或使用监听器（Listener）和条件（Condition）来异步接收数据。

8. **数据处理**：
   - 订阅者接收到数据后，可以根据需要对数据进行处理。这可能包括更新本地状态、触发事件或执行其他业务逻辑。

通过这个过程，DDS提供了一种机制，使得发布者可以发布数据，而订阅者可以根据自己的兴趣订阅和接收这些数据，从而实现分布式系统中的数据共享和通信。


## 概念

### 数据中心发布-订阅（DCPS）模型

数据中心发布-订阅（DCPS）模型是数据分发服务（DDS）的核心，它提供了一种机制，允许分布式系统中的应用组件发布和订阅数据。以下是DCPS模型的主要组成部分和概念：

- 域参与者（DomainParticipant）：域参与者是DCPS模型中的基本构建块，代表了一个分布式系统中的参与者。它作为一个通信实体，负责管理和协调其他DCPS实体（如发布者、订阅者、数据写入者和数据读取者）的活动。
- 发布者（Publisher）：发布者负责将数据发布到一个或多个主题上。它们拥有数据写入者（DataWriters），通过这些写入者将数据发送到感兴趣的订阅者。发布者还负责处理与数据分发相关的QoS策略。
- 数据写入者（DataWriter）：数据写入者是发布者的一个实例，它与特定的数据类型相关联，并负责将该类型的数据实例发布到关联的主题上。数据写入者处理数据的封装和传输。
- 订阅者（Subscriber）：订阅者表示对某些数据感兴趣的实体，它订阅一个或多个主题以接收数据。订阅者拥有数据读取者（DataReaders），通过这些读取者接收和处理来自发布者的数据。
- 数据读取者（DataReader）：数据读取者是订阅者的一个实例，它与特定的数据类型相关联，并负责从关联的主题接收数据实例。数据读取者提供了读取和获取数据的方法。
- 主题（Topic）：主题是DCPS模型中的一个关键概念，它定义了数据的类型和内容。主题作为数据发布和订阅的中介，允许发布者和订阅者之间进行数据交换。
- QoS策略（Quality of Service Policies）： QoS策略定义了数据传输和服务的行为和性能特征，如可靠性、持久性、传输延迟等。DCPS实体（如域参与者、发布者、订阅者等）可以设置QoS策略来满足特定的通信需求。
- 数据模型：DCPS模型使用数据模型来描述数据的结构和语义。数据模型包括了数据类型的定义，以及数据实例的创建、读取、更新和删除操作。

通过这些组件和概念，DCPS模型为分布式应用提供了一种灵活、高效且可扩展的通信机制，使得应用能够在不同的网络环境和系统配置中可靠地交换数据。

### 全球数据空间（Global Data Space）

全球数据空间是一个抽象概念，代表了所有订阅者可以访问的共享数据环境。在这个空间中，发布者可以发布数据，而订阅者可以订阅并接收这些数据。全球数据空间的关键特点包括：
- 共享性：全球数据空间中的所有数据对所有订阅者都是可见的，这意味着任何订阅者都可以访问和使用发布到主题的数据。
- 解耦性：发布者和订阅者不需要知道对方的存在或位置，它们只需与全球数据空间交互即可。这种解耦性提高了系统的灵活性和可扩展性。
- 一致性：虽然多个订阅者可能独立地访问全球数据空间中的数据，但DDS确保所有订阅者看到的是一致的数据视图，即数据的顺序和内容在所有订阅者之间保持一致。
- 实时性：全球数据空间支持实时数据分发，确保数据的及时更新和传递，满足实时应用的需求。


## 平台独立模型（PIM）

平台独立模型（PIM）是一种软件架构概念，它提供了一个独立于具体实现平台的抽象模型。在数据分发服务（DDS）的上下文中，PIM是定义DDS规范中核心概念和接口的抽象模型，它不依赖于任何特定的编程语言或平台。

PIM的主要特点和作用包括：

1. **抽象**：PIM提供了一个高层次的抽象，描述了DDS的架构、实体、接口和行为，而不指定如何实现这些抽象概念。

2. **独立性**：PIM的设计使得它不受特定技术或平台的限制，因此可以被不同的DDS实现所遵循，无论它们是用C、Java、C++还是其他编程语言编写的。

3. **规范性**：PIM定义了DDS规范的标准接口和数据类型，确保了不同供应商和实现之间的互操作性和一致性。

4. **扩展性**：PIM允许在保持核心规范稳定的同时，通过添加新的实体、接口或功能来扩展DDS的能力。

5. **实现指导**：PIM为实现DDS的供应商提供了一个蓝图，指导他们如何在自己的平台上实现DDS的功能。

在DDS规范中，PIM通常包括以下组件：

- **实体（Entities）**：如域参与者（DomainParticipant）、发布者（Publisher）、订阅者（Subscriber）、数据写入者（DataWriter）和数据读取者（DataReader）等，它们是DDS通信的基本构建块。

- **接口**：定义了实体之间交互的方法和操作，例如创建、删除、查询和修改实体的行为。

- **类和结构**：描述了数据类型和结构，这些是用于数据发布和订阅的基本单元。

- **QoS策略**：定义了服务质量策略的集合，允许配置DDS实体的行为，如可靠性、持久性和传输延迟等。

PIM是DDS规范的基础，它确保了DDS可以在多种平台上实现，同时保持核心功能和行为的一致性。

### PIM的架构
PIM（平台独立模型）是DDS（数据分发服务）规范中的一个抽象层次，它定义了分布式系统中数据通信的架构和行为，而不依赖于任何特定的实现平台或编程语言。PIM的架构主要由以下几个核心组件构成：

1. **域参与者（DomainParticipant）**：
   - 代表DDS系统中的一个通信实体，通常是应用程序或服务。域参与者负责创建和管理其他DDS实体，如发布者、订阅者、数据写入者、数据读取者和主题。

2. **发布者（Publisher）**：
   - 负责将数据发布到一个或多个主题上。发布者包含数据写入者，通过它们将数据分发给订阅者。

3. **数据写入者（DataWriter）**：
   - 与特定的数据类型关联，负责将数据实例发布到关联的主题上。数据写入者处理数据的封装、传输和与QoS策略相关的操作。

4. **订阅者（Subscriber）**：
   - 表示对数据感兴趣的实体，它订阅主题以接收数据。订阅者包含数据读取者，用于接收和处理数据。

5. **数据读取者（DataReader）**：
   - 与特定的数据类型关联，负责从关联的主题接收数据实例。数据读取者提供了读取和获取数据的方法。

6. **主题（Topic）**：
   - 作为数据发布和订阅的中介，定义了数据的类型和内容。主题允许发布者发布数据和订阅者订阅数据。

7. **QoS策略（Quality of Service Policies）**：
   - 一组可配置的参数，定义了数据传输和处理的行为和性能特征，如可靠性、持久性、传输延迟等。

8. **监听器（Listener）**：
   - 用于异步接收有关通信状态变化的通知，如数据到达、活跃性变化等。

9. **条件（Condition）**：
   - 与监听器结合使用，提供了一种机制来等待特定条件的发生，如数据变得可用。

10. **等待集（WaitSet）**：
   - 允许应用程序等待一个或多个条件变为真（trigger_value变为TRUE），以便知道何时有数据可读或有其他重要的事件发生。

PIM的架构设计为分布式系统中的数据通信提供了一个清晰、一致的模型，使得开发者可以专注于实现业务逻辑，而不必关心底层的通信细节。通过这种方式，PIM支持了DDS的可移植性和互操作性，允许不同供应商和实现之间的无缝集成。

### PIM的设计原理
PIM（平台独立模型）的设计原理基于以下几个核心概念，这些概念共同构成了DDS（数据分发服务）的抽象框架，使其能够在不同的平台和语言环境中实现一致的行为和功能：

1. **抽象化**：
   - PIM提供了一个抽象层，使得DDS的实现和应用开发可以独立于具体的硬件和软件平台。这种抽象化允许DDS规范在多种编程语言和操作系统上实现，同时保持核心功能和行为的一致性。

2. **模块化**：
   - PIM的设计遵循模块化原则，将其分解为独立的模块和组件，如域参与者、发布者、订阅者、数据写入者、数据读取者、主题等。每个模块都有明确的职责和接口，便于理解和实现。

3. **解耦合**：
   - PIM支持发布者和订阅者之间的解耦合通信，这意味着它们不需要知道对方的存在或位置。这种设计提高了系统的灵活性和可扩展性，允许分布式系统中的组件在不中断服务的情况下动态加入或离开。

4. **数据为中心**：
   - PIM以数据为中心，通过主题来组织和传输数据。数据写入者发布数据到主题，而数据读取者订阅主题以接收数据。这种以数据为中心的通信模式简化了分布式系统中的数据交换。

5. **服务质量（QoS）**：
   - PIM允许通过QoS策略来定制数据传输的行为和性能，如可靠性、持久性、传输延迟等。这些策略为DDS提供了高度的灵活性，使其能够适应不同的应用需求和网络条件。

6. **通信状态管理**：
   - PIM提供了机制来管理和通知通信状态的变化，如数据到达、活跃性变化等。通过监听器和条件，应用程序可以异步地接收这些状态变化的通知。

7. **互操作性**：
   - PIM的设计考虑了不同DDS实现之间的互操作性，确保遵循DDS规范的实现能够无缝地通信和集成。

8. **可扩展性**：
   - PIM的设计允许通过添加新的实体、接口或功能来扩展DDS的能力，以支持更复杂的应用场景和高级特性。

通过这些设计原理，PIM为DDS提供了一个强大、灵活且可扩展的框架，使其能够适应各种分布式系统的需求，同时保持跨平台的一致性和可移植性。

### PIM中的类和接口

在平台独立模型（PIM）中，类和接口是定义DDS系统行为和结构的核心元素。以下是PIM中一些关键的类和接口，以及它们的功能和作用：

1. **Entity**：
   - 这是一个抽象基类，所有DDS实体都继承自它。Entity类提供了一些基本的操作，如启用和禁用实体、获取实体的QoS策略以及获取实体的状态信息。

2. **DomainParticipant**：
   - 表示DDS通信域中的一个参与者。它负责创建和管理其他DDS实体，如发布者、订阅者和主题。它还处理与通信域相关的安全和发现机制。

3. **Publisher** 和 **Subscriber**：
   - Publisher类代表数据发布者，负责将数据写入到主题。Subscriber类代表数据订阅者，负责从主题读取数据。它们都继承自Entity类，并添加了特定于发布和订阅的功能。

4. **DataWriter** 和 **DataReader**：
   - DataWriter接口定义了发布数据到主题的操作，如写入数据样本、处理实例注册和注销等。DataReader接口定义了从主题读取数据的操作，如读取和获取数据样本、处理样本状态和实例状态等。

5. **Topic** 和 **TopicDescription**：
   - Topic类表示DDS中的主题，它是数据发布和订阅的中心概念。TopicDescription类提供了主题的元数据，如主题名称和数据类型，但不包含与特定发布者或订阅者相关的信息。

6. **QosPolicy**：
   - 这是一个抽象基类，定义了QoS策略的框架。具体的QoS策略类继承自QosPolicy，如Durability、Reliability、History等，它们定义了不同方面的服务质量。

7. **Listener**：
   - 这个接口定义了监听器的行为，它用于异步接收有关通信状态变化的通知。Listener可以与各种DDS实体结合使用，以监听不同的事件。

8. **Condition**：
   - Condition接口与Listener结合使用，提供了一种机制来等待特定条件的发生。它通常与WaitSet一起使用，以实现基于条件的同步操作。

9. **WaitSet**：
   - WaitSet类提供了一种机制，允许应用程序等待一个或多个条件变为真。它允许应用程序在数据变得可用或发生其他重要事件时被通知。

10. **TypeSupport**：
    - 这个接口用于注册和管理DDS中使用的数据类型。它允许DDS系统理解和处理应用程序定义的数据类型。

这些类和接口通过它们的操作和关系，共同构成了DDS系统的架构。它们为分布式应用提供了一种灵活、高效且可扩展的通信机制，使得应用能够在不同的网络环境和系统配置中可靠地交换数据。

### PIM中的QoS（服务质量）策略和它们如何影响服务行为
在平台独立模型（PIM）中，QoS（Quality of Service）策略是一组可配置的参数，它们定义了DDS服务的行为和性能。QoS策略允许应用程序根据具体的需求和条件来定制数据传输和处理的方式。以下是一些常见的QoS策略以及它们如何影响服务行为：

1. **持久性（Durability）**：
   - 定义了数据的持久性级别，确定数据在网络中的存活时间以及在通信故障后数据是否仍然可用。
   - 持久性策略影响数据的存储和重发行为，确保数据不会因为网络问题而丢失。

2. **可靠性（Reliability）**：
   - 指定了数据传输的可靠性级别，决定了DDS是否应确保数据被可靠地传输到所有订阅者。
   - 可靠性策略影响数据的重传机制，包括在数据丢失或网络延迟时的行为。

3. **传输优先级（Transport Priority）**：
   - 为数据传输设置了优先级，高优先级的数据将在低优先级数据之前传输。
   - 传输优先级策略影响网络流量的管理和调度，确保关键数据能够优先处理。

4. **生命周期（Lifespan）**：
   - 定义了数据的生命周期，即数据在系统中存在的最长时间。
   - 生命周期策略影响数据的过期和清理，确保旧数据不会无限期地占用资源。

5. **目的地顺序（Destination Order）**：
   - 指定了数据在多个订阅者之间传输的顺序。
   - 目的地顺序策略影响数据的接收顺序，确保所有订阅者以一致的顺序接收数据。

6. **历史记录（History）**：
   - 定义了DDS保留数据样本的历史记录的数量和类型。
   - 历史记录策略影响数据的存储和访问，特别是在处理迟到的订阅者或重新连接的订阅者时。

7. **资源限制（Resource Limits）**：
   - 为DDS实体（如发布者、订阅者、数据写入者和数据读取者）设置了资源使用的限制。
   - 资源限制策略影响DDS的内存和带宽使用，防止系统资源被耗尽。

8. **呈现（Presentation）**：
   - 定义了如何向订阅者呈现数据，包括访问范围和数据的有序性。
   - 呈现策略影响数据的可见性和订阅者接收数据的方式。

9. **所有权（Ownership）**：
   - 指定了数据实例的所有权管理，包括多个发布者对同一数据实例的写入权限。
   - 所有权策略影响数据的一致性和更新冲突的解决。

通过这些QoS策略，DDS提供了高度的灵活性和可配置性，使得应用程序可以根据不同的应用场景和性能要求来优化数据通信。开发者可以根据需要调整这些策略，以实现最佳的系统性能和资源利用。


## 平台特定模型（PSM）

平台特定模型（PSM）是数据分发服务（DDS）规范中的一个组成部分，它将平台独立模型（PIM）中的抽象概念映射到特定编程语言和平台上。PSM定义了如何将PIM中的类、接口和数据结构转换为特定平台上的实现，包括必要的数据类型、操作和API。

PSM的主要目的是提供一种机制，使得DDS规范可以在不同的编程语言和环境中实现，同时保持与PIM的一致性和互操作性。这样，无论DDS实现是基于C、Java、C++还是其他语言，它们都能够遵循相同的通信协议和数据模型，从而实现跨平台的数据交换和系统集成。

PSM的关键特点包括：

1. **语言和平台绑定**：
   - PSM定义了与特定编程语言和运行时环境相关的数据类型和操作。例如，它可能指定如何在C++中实现一个DDS实体，或者如何在Java中处理QoS策略。

2. **性能优化**：
   - 通过针对特定平台的特性进行优化，PSM可以提高DDS实现的性能。这可能包括内存管理、线程处理和网络通信的优化。

3. **互操作性**：
   - PSM确保不同平台上的DDS实现能够相互通信，即使它们使用不同的编程语言或运行时环境。

4. **可移植性**：
   - 通过提供一套标准化的映射规则，PSM使得DDS应用可以在多个平台上移植和运行，而不需要对源代码进行大量修改。

5. **易用性**：
   - PSM提供了与特定语言风格一致的API，使得开发者可以更容易地使用DDS功能，而不需要深入了解底层的通信细节。

PSM是实现DDS规范的关键步骤，它桥接了PIM的抽象世界和实际的软件实现，使得DDS能够在现实世界中的多样化环境中发挥作用。

### PIM到PSM的映射规则

PIM（平台独立模型）到PSM（平台特定模型）的映射规则是一组指导原则和转换步骤，用于将DDS（数据分发服务）规范中的抽象概念和接口转换为特定编程语言和平台上的具体实现。这些规则确保了不同实现之间的互操作性和可移植性，同时允许优化以适应特定平台的特性。以下是一些常见的映射规则：

1. **数据类型映射**：
   - PIM中定义的抽象数据类型需要映射到目标编程语言的数据类型。例如，PIM中的`BuiltinTopicKey_t`可能映射到C语言的`unsigned long`类型，或者Java的`long`类型。

2. **接口实现**：
   - PIM中的接口在PSM中需要具体实现。例如，`DataReader`接口定义了读取数据的方法，而在PSM中，这些方法需要用特定语言的代码来实现。

3. **类和结构体**：
   - PIM中的类在PSM中通常映射为目标语言的类或结构体。例如，PIM中的`Entity`类可能在C++ PSM中映射为一个类，而在C PSM中可能映射为一个结构体。

4. **操作和方法**：
   - PIM中定义的操作和方法在PSM中需要具体实现。这包括将参数类型、返回类型和异常处理映射到目标语言的相应特性。

5. **QoS策略**：
   - PIM中定义的QoS策略在PSM中需要具体化。例如，`DurabilityQosPolicy`可能需要映射到具体的内存分配和数据持久化机制。

6. **错误处理**：
   - PIM中的错误返回值在PSM中需要映射到目标语言的错误处理机制。例如，返回代码可能需要转换为异常抛出或错误码返回。

7. **序列化和反序列化**：
   - PIM中的数据样本需要在PSM中进行序列化和反序列化，以便在网络上传输。这涉及到将数据结构转换为字节流，并在接收端重新构建数据结构。

8. **内存管理**：
   - PIM中的内存分配和释放操作在PSM中需要映射到目标语言的内存管理机制。例如，C++中的`new`和`delete`操作，或者Java中的垃圾回收机制。

9. **线程和同步**：
   - PIM中的并发和同步概念在PSM中需要映射到目标语言的线程和同步机制。例如，使用C++的互斥锁或Java的`synchronized`关键字。

10. **平台特性利用**：
    - PSM可以实现特定平台的特性，如利用特定操作系统的网络特性或硬件加速功能，以提高性能。

通过遵循这些映射规则，DDS的实现者可以创建出既符合规范又针对特定平台优化的PSM实现。这确保了DDS在不同环境中的一致性和效率，同时允许开发者利用他们熟悉的编程语言和工具。

### PSM中的数据类型、错误返回值和特定于平台的类型

在平台特定模型（PSM）中，数据类型、错误返回值和特定于平台的类型是实现DDS规范的关键组成部分。它们需要根据目标编程语言和运行环境的特性进行适当的映射和实现。以下是这些组件的讨论：

- 数据类型：PSM中的数据类型必须与PIM中定义的抽象数据类型相匹配，同时考虑到目标编程语言的特性。例如：
   - **基本数据类型**：如整数、浮点数和布尔值通常可以直接映射到目标语言的内置类型。
   - **字符串**：在PIM中可能表示为`string`，在PSM中需要映射到目标语言的字符串表示，如C++中的`std::string`或Java中的`String`。
   - **序列化**：对于复杂的数据结构，PSM需要提供序列化和反序列化的方法，以便在网络上传输和存储。
   - **枚举类型**：PIM中的枚举（`enum`）可能需要映射到目标语言的枚举或整数类型。

- 错误返回值：在PSM中，错误返回值用于指示操作的成功或失败。这些返回值必须与PIM中定义的错误代码一致，并且需要映射到目标语言的表示方式。例如：
   - **返回代码**：PIM中定义的返回代码，如`RETCODE_OK`或`RETCODE_ERROR`，在PSM中可能映射为整数常量。
   - **异常处理**：在支持异常的语言中，如Java或C++，错误可能通过抛出异常来表示，而不是使用返回代码。

- 特定于平台的类型：PSM可能需要定义一些特定于平台的类型，以支持DDS规范中的某些特性。这些类型可能包括：
   - **句柄**：用于唯一标识实体的句柄类型，如`InstanceHandle_t`，在PSM中可能映射为目标语言的整数类型或特定的句柄类。
   - **时间表示**：时间类型，如`Duration_t`和`Time_t`，需要映射到能够表示时间的类型，这可能涉及到使用目标语言的日期和时间库。
   - **集合和容器**：PIM中的数据集合，如序列（`sequence`），在PSM中可能映射为目标语言的数组、列表或其他集合类型。
   - **原生类型**：某些DDS实现可能使用原生类型（如C语言中的`void*`）来提供灵活性，这些在PSM中需要找到合适的映射。

在实现PSM时，开发者必须确保这些类型和值的选择既能满足DDS规范的要求，又能最大化目标平台的性能和功能。此外，PSM的实现还需要考虑到目标平台的内存管理、线程安全和网络通信机制。通过这种方式，PSM为DDS提供了跨平台的实现基础，同时允许每个平台的特定优化。


## 交互模型

### DDS的发布和订阅交互模型

DDS（Data Distribution Service）的发布和订阅交互模型是一种基于主题（Topic）的通信模式，它允许分布式系统中的参与者（称为发布者和订阅者）高效地交换数据。以下是DDS发布和订阅交互模型的关键组成部分和流程：

1. **主题（Topic）**：
   - 主题是发布和订阅交互的核心。它定义了数据的类型和内容，充当发布者发布数据和订阅者接收数据的中介。主题可以被视为一个通信频道，所有参与者都通过它来交换信息。

2. **发布者（Publisher）**：
   - 发布者是负责发布数据到主题的实体。它可以有一个或多个数据写入者（DataWriter），通过这些数据写入者将数据样本发布到主题。发布者根据配置的QoS（服务质量）策略来控制数据的发布行为，如可靠性、持久性和传输优先级。

3. **数据写入者（DataWriter）**：
   - 数据写入者是发布者的一部分，它与特定的数据类型关联。数据写入者负责封装数据并处理数据的发布，包括写入操作、实例管理以及与QoS策略相关的操作。

4. **订阅者（Subscriber）**：
   - 订阅者表示对主题中数据感兴趣的实体。它可以有一个或多个数据读取者（DataReader），通过这些数据读取者从主题接收数据样本。订阅者根据配置的QoS策略来控制数据的接收行为，如数据的可靠性和接收顺序。

5. **数据读取者（DataReader）**：
   - 数据读取者是订阅者的一部分，它与特定的数据类型关联。数据读取者负责从主题接收数据样本，并提供了读取和获取数据的方法。数据读取者还处理与QoS策略相关的数据接收，如样本状态和实例状态。

6. **数据分发**：
   - DDS中间件负责将数据从发布者分发到订阅者。它根据主题匹配和QoS策略来管理数据的路由和传输。DDS确保数据按照订阅者的需要和发布者的QoS承诺进行分发。

7. **匹配和通知**：
   - 当发布者发布数据到主题时，DDS中间件检查订阅者的兴趣和QoS策略，以确定哪些订阅者应该接收数据。一旦匹配，DDS中间件将数据样本发送给相应的订阅者。

8. **异步通信**：
   - DDS支持异步通信，订阅者可以通过监听器（Listener）和条件（Condition）来异步接收数据。这样，订阅者可以在数据变得可用时立即得到通知，而不需要不断轮询数据。

通过这种发布和订阅交互模型，DDS为分布式系统中的实时数据共享提供了一种高效、可靠且可扩展的通信机制。它允许发布者和订阅者在不了解对方具体实现的情况下进行通信，从而实现了系统组件之间的解耦和易于维护。

### 介绍使用监听器和条件/等待集的机制来异步通知应用程序关于通信状态的变化

在DDS（Data Distribution Service）中，监听器（Listener）和条件（Condition）以及等待集（WaitSet）是实现异步通知的关键机制。这些机制允许应用程序在数据变得可用或通信状态发生变化时得到通知，而不需要不断轮询DDS中间件。以下是这些机制的详细介绍：
- 监听器（Listener）：监听器是一个回调接口，它定义了一组方法，这些方法可以在特定的事件发生时被DDS中间件调用。应用程序通过实现这些方法来指定如何处理事件。例如，监听器可以定义在新数据到达、数据写入者失去活跃性或订阅者匹配数据写入者时的行为。
- 条件（Condition）：条件是一个与监听器相关联的对象，它表示一个特定的事件或一组事件。条件可以被附加到等待集上，当条件的触发值（trigger_value）变为真（true）时，表示相关的事件发生了。条件的触发值通常与监听器中定义的事件相对应。
- 等待集（WaitSet）：等待集是一个DDS实体，它允许应用程序等待一个或多个条件变为真。当至少有一个条件触发时，等待集将通知应用程序，这样应用程序可以响应事件而不需要轮询。等待集提供了一种有效的方式来暂停执行，直到DDS中有重要的事件发生。

异步通知的工作流程：
1. **创建监听器**：应用程序实现监听器接口，并创建监听器对象。
2. **设置条件**：应用程序创建条件对象，并将其附加到监听器上。条件定义了感兴趣的事件，例如新数据的到来。
3. **注册等待集**：应用程序将条件注册到等待集上。这样，当条件的触发值为真时，等待集将被激活。
4. **等待事件**：应用程序调用等待集的等待（wait）操作，这个操作会阻塞执行，直到一个或多个条件变为真。
5. **处理事件**：一旦等待集返回，应用程序就可以检查哪些条件被触发，并调用相应的监听器方法来处理事件。

通过使用监听器、条件和等待集，DDS提供了一种高效的异步通信机制，允许应用程序在不牺牲性能的情况下响应实时数据和通信状态的变化。这种机制对于需要快速响应和高吞吐量的分布式实时系统尤为重要。


## DDS内置主题

### DDS内置主题的概念

DDS（Data Distribution Service）内置主题是DDS规范中定义的一组特殊的主题，它们不用于普通的数据分发，而是用于传播关于DDS域内参与者和其活动的状态信息。这些内置主题使得DDS参与者能够发现彼此，以及了解域内其他参与者的存在、状态变化和网络拓扑结构。以下是一些关键的内置主题及其概念：

1. **DCPSParticipant**：
   - 此内置主题用于传播有关DDS域内参与者（DomainParticipant）的信息。当一个新的参与者加入域或现有参与者离开域时，相关信息会在DCPSParticipant主题上发布。这允许域内的其他参与者了解网络中参与者的存在和变更。

2. **DCPSTopic**：
   - 此主题用于传播有关DDS域内所有主题（Topic）的信息。当创建或删除主题时，相关信息会在DCPSTopic上发布。订阅此主题的参与者可以了解其他主题的创建和删除，从而动态地调整其订阅和数据接收行为。

3. **DCPSPublication**：
   - 此主题用于传播有关DDS域内所有发布者（Publisher）和数据写入者（DataWriter）的信息。当发布者或数据写入者加入或离开域时，相关信息会在DCPSPublication上发布。这使得订阅者能够发现新的数据源，或者在数据源不再可用时进行适当的处理。

4. **DCPSSubscription**：
   - 类似于DCPSPublication，此主题用于传播有关DDS域内所有订阅者（Subscriber）和数据读取者（DataReader）的信息。当订阅者或数据读取者加入或离开域时，相关信息会在DCPSSubscription上发布。这有助于发布者了解潜在的数据接收者。

这些内置主题通常由DDS实现自动管理，不需要应用程序直接发布或订阅。相反，应用程序可以通过创建内置DataReader对象来接收这些主题的信息。通过这种方式，DDS提供了一种机制，使得应用程序可以发现和理解分布式环境中其他实体的存在和状态，从而实现更高级的网络管理和动态行为适应。

### 这些主题用于传播关于远程实体（如参与者、主题和数据写入者）的信息

DDS（Data Distribution Service）内置主题用于传播关于远程实体的信息，这些实体包括参与者（Participants）、主题（Topics）和数据写入者（DataWriters）。这些信息对于分布式系统中的实体发现、状态监控和网络管理至关重要。以下是这些内置主题的具体作用：

1. **DCPSParticipant**：
   - 此主题用于传播参与者的存在和状态信息。当一个新的参与者加入DDS域或现有参与者离开时，关于其加入或离开的信息会被发布到DCPSParticipant主题上。这样，域内的其他参与者可以发现新的参与者或检测到参与者的离开，从而相应地调整它们的通信行为。

2. **DCPSTopic**：
   - 此主题用于传播主题的元数据信息。当一个新的主题被创建或现有主题被删除时，相关信息会被发布到DCPSTopic上。订阅此主题的参与者可以接收到关于新主题的创建和现有主题的删除的通知，这有助于参与者了解可用的主题列表及其变更。

3. **DCPSPublication**：
   - 此主题用于传播有关数据写入者和发布者的信息。当一个新的数据写入者或发布者加入DDS域时，其信息会被发布到DCPSPublication主题上。订阅此主题的订阅者可以发现新的数据源，了解哪些数据写入者正在发布数据，以及它们的QoS策略等信息。

4. **DCPSSubscription**：
   - 此主题用于传播有关数据读取者和订阅者的信息。当一个新的数据读取者或订阅者加入DDS域时，其信息会被发布到DCPSSubscription主题上。这允许发布者了解可能对其发布的数据感兴趣的订阅者，以及它们的QoS策略等信息。

这些内置主题的信息通常包括实体的ID、名称、类型、QoS策略和其他相关属性。通过订阅和读取这些内置主题，参与者可以获取关于域内其他实体的详细信息，从而实现网络的自我配置和动态适应。例如，一个订阅者可以利用DCPSPublication主题的信息来决定它应该订阅哪些数据写入者的数据，或者一个发布者可以利用DCPSSubscription主题的信息来优化其数据分发策略。

这些主题的自动传播机制是DDS动态发现和配置能力的基础，它们使得DDS能够在没有中央目录服务的情况下支持分布式系统的实时通信和数据交换。

### 如何通过内置DataReader对象访问内置主题

在DDS（Data Distribution Service）中，内置主题（如`DCPSParticipant`、`DCPSTopic`、`DCPSPublication`和`DCPSSubscription`）提供了关于DDS域内实体（参与者、主题和数据写入者/订阅者）的信息。要访问这些内置主题，应用程序通常会创建专门的DataReader对象，这些对象是专门为读取内置主题上的信息而设计的。以下是通过内置DataReader对象访问内置主题的一般步骤：

1. **获取内置DataReader**：
   - 通过调用域参与者（DomainParticipant）的`get_builtin_subscriber`方法来获取对内置订阅者（Built-in Subscriber）的引用。
   - 使用内置订阅者的`create_datareader`方法来创建一个新的DataReader对象，指定要订阅的内置主题（例如`DCPSPublication`）。

2. **设置QoS策略**：
   - 为新建的DataReader设置所需的QoS（服务质量）策略，例如可靠性、持久性等，这些策略将应用于从内置主题接收的数据。

3. **注册数据类型**：
   - 如果内置主题的数据类型未被注册，需要先通过使用`TypeSupport`接口的`register_type`方法来注册数据类型。

4. **读取数据**：
   - 使用DataReader的`read`或`take`操作来读取从内置主题发布的消息。这些操作将填充包含有关DDS实体状态和活动信息的样本。

5. **处理样本**：
   - 处理读取到的样本，提取有关DDS实体的信息。例如，当新的数据写入者加入域时，`DCPSPublication`主题将发布包含其信息的样本。

6. **监听事件**（可选）：
   - 可以为DataReader设置监听器（Listener），并在监听器中定义回调方法来响应特定的事件，如新实体的出现或现有实体的消失。

通过这种方式，应用程序可以异步地接收有关DDS域内实体状态变化的通知，从而实现对分布式系统内部动态的监控和管理。内置DataReader对象提供了一种机制，使得应用程序能够以一种标准化和一致的方式与DDS域内的其他实体交互。


## 监听器、条件和等待集

### 详细介绍监听器和条件的使用方法，以及如何通过等待集同步或异步地等待特定条件的发生

在DDS（Data Distribution Service）中，监听器（Listener）和条件（Condition）以及等待集（WaitSet）是实现异步通知和同步等待事件的关键机制。以下是这些机制的详细介绍和使用方法：

### 监听器（Listener）

监听器是一个回调接口，它定义了一组方法，这些方法可以在特定的事件发生时被DDS中间件调用。应用程序通过实现这些方法来指定如何处理事件。例如，监听器可以定义在新数据到达、数据写入者失去活跃性或订阅者匹配数据写入者时的行为。

**使用方法**：

1. **实现监听器接口**：应用程序需要为感兴趣的实体（如DataReader或Subscriber）实现相应的监听器接口。

2. **设置监听器**：通过调用实体的`set_listener`方法，将实现的监听器对象与特定的条件（如`DATA_ON_READERS`）关联起来。

3. **处理事件**：在监听器的回调方法中编写逻辑，以处理事件发生时的行为，如读取数据、更新UI或触发其他操作。

### 条件（Condition）

条件是一个与监听器相关联的对象，它表示一个特定的事件或一组事件。条件可以被附加到等待集上，当条件的触发值（trigger_value）变为真（true）时，表示相关的事件发生了。

**使用方法**：

1. **创建条件**：通过调用实体的`create_condition`方法创建一个新的条件对象。

2. **设置条件参数**：为条件对象设置相关的参数，如样本状态、实例状态等，这些参数定义了条件触发的规则。

3. **附加条件到等待集**：将条件对象附加到等待集上，使用`WaitSet::attach_condition`方法。

### 等待集（WaitSet）

等待集是一个DDS实体，它允许应用程序等待一个或多个条件变为真。当至少有一个条件触发时，等待集将通知应用程序，这样应用程序可以响应事件而不需要轮询DDS中间件。

**同步等待**：

1. **创建等待集**：通过调用`WaitSet`类的构造函数创建一个新的等待集实例。

2. **附加条件**：使用`WaitSet::attach_condition`方法将条件对象附加到等待集上。

3. **调用等待操作**：调用`WaitSet::wait`方法，传入一个条件序列和一个超时时间。此操作将阻塞，直到至少有一个条件变为真或超时时间到达。

**异步等待**：

1. **设置监听器**：为等待集设置监听器，以便在条件触发时得到通知。

2. **注册条件**：使用`WaitSet::get_condition`方法注册条件，并获取一个可以操作的条件对象。

3. **触发回调**：当条件触发时，DDS中间件将调用监听器的回调方法，应用程序可以在回调方法中处理事件。

通过这些机制，应用程序可以灵活地选择是立即响应事件（同步等待），还是等待事件发生后再处理（异步等待）。这使得DDS能够支持复杂的事件驱动逻辑，同时保持高效的数据处理和低延迟的响应能力。

### 讨论各种通信状态变化的监听和处理

在DDS（Data Distribution Service）中，监听和处理各种通信状态变化是实现高效、可靠的分布式系统的关键。DDS提供了一系列的通信状态，以及与之对应的监听器和条件，使得应用程序能够响应数据传输中的各种情况。以下是一些常见的通信状态变化及其监听和处理方法：

- 样本可用（DATA_AVAILABLE / DATA_ON_READERS）：
当新的数据样本对于DataReader可用时，这个状态变化会被触发。应用程序可以通过设置一个DataReaderListener来监听这个状态，然后在回调方法中读取或获取数据。

- 样本拒绝（SAMPLE_REJECTED）：
当一个数据样本因为某些原因（如实例限制或样本大小限制）被拒绝时，这个状态变化会被触发。应用程序可以使用SampleRejectedStatus和相应的监听器来跟踪和处理被拒绝的样本。

- 活跃性变化（LIVELINESS_CHANGED）：
当与DataReader关联的DataWriter的活跃性状态发生变化时（例如，DataWriter变得活跃或非活跃），这个状态会被触发。通过监听这个状态，应用程序可以得知数据源的活跃性，并作出相应的调整。

- 请求的截止时间错过（REQUESTED_DEADLINE_MISSED）：
当DataWriter未能在其QoS策略中定义的截止时间内发送数据时，这个状态变化会被触发。应用程序可以使用RequestedDeadlineMissedStatus来监听和处理这种情况。

- 订阅匹配（SUBSCRIPTION_MATCHED）：
当DataReader找到与之匹配的DataWriter，或者停止与某个DataWriter匹配时，这个状态变化会被触发。通过监听这个状态，应用程序可以了解数据可用性的变化。

- 数据发布匹配（PUBLICATION_MATCHED）：
与SUBSCRIPTION_MATCHED相对应，当DataWriter找到与之匹配的DataReader，或者停止与某个DataReader匹配时，这个状态变化会被触发。DataWriter可以使用PublicationMatchedStatus来监听匹配的变化。

- 样本丢失（SAMPLE_LOST）：
当数据样本因为内部缓冲区溢出或其他原因而丢失时，这个状态变化会被触发。应用程序可以使用SampleLostStatus来监听样本丢失事件。

监听和处理方法

为了监听和处理这些通信状态变化，应用程序需要执行以下步骤：

1. **创建监听器**：为感兴趣的实体（如DataReader或DataWriter）创建并配置监听器对象。

2. **设置监听器**：通过调用实体的`set_listener`方法，将监听器与特定的状态变化关联起来。

3. **定义条件**：对于需要等待的状态变化，定义相应的条件对象，并将其附加到等待集上。

4. **等待或回调**：根据应用程序的需要，选择使用等待集同步等待状态变化（阻塞式），或者通过监听器的回调方法异步处理状态变化。

通过这种方式，DDS提供了一种机制，使得应用程序可以有效地响应数据传输中的各种情况，从而实现更高级的错误处理、数据恢复和系统监控。

## QoS（服务质量）支持

QoS（Quality of Service）支持是指在数据通信和网络服务中提供一系列服务参数的配置和管理能力，以确保满足特定的性能要求。

### 详细说明DDS支持的各种QoS策略

DDS（Data Distribution Service）支持一系列的QoS（Quality of Service）策略，这些策略允许用户根据特定的应用需求来定制数据传输的行为和性能。以下是DDS支持的各种QoS策略的详细说明：

1. **持久性（Durability）**：
   - 定义了数据的持久性级别，确保数据在网络中的存活时间以及在通信故障后数据是否仍然可用。持久性策略可以配置为“易失性”（VOLATILE）、“瞬态本地”（TRANSIENT_LOCAL）、“瞬态”（TRANSIENT）或“持久”（PERSISTENT）。

2. **可靠性（Reliability）**：
   - 指定了数据传输的可靠性级别，决定了DDS是否应确保数据被可靠地传输到所有订阅者。可靠性策略包括消息重传、超时检测和确认机制。

3. **传输优先级（Transport Priority）**：
   - 为数据传输设置了优先级，高优先级的数据将在低优先级数据之前传输。这有助于确保关键数据能够优先处理。

4. **生命周期（Lifespan）**：
   - 定义了数据的生命周期，即数据在系统中存在的最长时间。生命周期策略影响数据的过期和清理，确保旧数据不会无限期地占用资源。

5. **目的地顺序（Destination Order）**：
   - 指定了数据在多个订阅者之间传输的顺序。这个策略影响数据的接收顺序，确保所有订阅者以一致的顺序接收数据。

6. **历史记录（History）**：
   - 定义了DDS保留数据样本的历史记录的数量和类型。历史策略影响数据的存储和访问，尤其是在处理迟到的订阅者或重新连接的订阅者时。

7. **资源限制（Resource Limits）**：
   - 为DDS实体（如发布者、订阅者、数据写入者和数据读取者）设置了资源使用的限制。资源限制策略影响DDS的内存和带宽使用，防止系统资源被耗尽。

8. **呈现（Presentation）**：
   - 定义了如何向订阅者呈现数据，包括访问范围和数据的有序性。呈现策略影响数据的可见性和订阅者接收数据的方式。

9. **所有权（Ownership）**：
   - 指定了数据实例的所有权管理，包括多个发布者对同一数据实例的写入权限。所有权策略影响数据的一致性和更新冲突的解决。

10. **所有权强度（Ownership Strength）**：
    - 用于在多个发布者尝试修改同一数据实例时，确定哪个发布者拥有更强的所有权。

11. **时间基于过滤器（Time-Based Filter）**：
    - 允许订阅者指定他们只对在特定时间间隔内更改的数据实例感兴趣。

12. **分区（Partition）**：
    - 允许在主题上定义逻辑分区，这样只有共享相同分区名称的发布者和订阅者之间才会交换数据。

13. **组数据（Group Data）**：
    - 允许发布者和订阅者附加额外的数据，这些数据与分区和主题相关联，但不被实际的数据内容所取代。

通过这些QoS策略，DDS为分布式系统中的数据通信提供了高度的灵活性和可配置性，使得应用程序可以根据不同的应用场景和性能要求来优化数据通信。开发者可以根据需要调整这些策略，以实现最佳的系统性能和资源利用。

### 讨论如何通过QoS策略配置DDS实体的行为

在DDS（Data Distribution Service）中，QoS（服务质量）策略用于配置和管理DDS实体的行为，以满足特定应用程序的性能和服务要求。DDS实体包括域参与者（DomainParticipant）、发布者（Publisher）、订阅者（Subscriber）、数据写入者（DataWriter）和数据读取者（DataReader）。以下是如何通过QoS策略配置这些实体行为的讨论：

1. 配置域参与者（DomainParticipant）
- **持久性**：可以设置为瞬态或持久，影响参与者在网络中的存活时间。
- **分区**：定义了参与者可见的主题分区，影响数据的分发范围。

2. 配置发布者（Publisher）
- **可靠性**：设置为最佳努力或可靠，影响数据传输的可靠性和重传行为。
- **持久性**：与数据写入者的持久性设置相结合，影响数据在网络中的存储和存活。
- **传输优先级**：为发布者的数据流设置优先级，确保关键数据优先传输。

3. 配置数据写入者（DataWriter）
- **数据写入者生命周期**：配置数据实例的生命周期，包括实例的创建和删除行为。
- **所有权**：设置数据实例的所有权策略，如共享或独占。
- **时间基于过滤器**：设置数据实例的更新频率，以控制数据的传输速率。

4. 配置订阅者（Subscriber）
- **可靠性**：与发布者相同，设置为最佳努力或可靠，影响数据接收的可靠性。
- **呈现**：配置如何向订阅者呈现数据，包括数据的访问范围和有序性。
- **历史记录**：设置保留数据样本的历史记录数量和类型，影响数据的存储和访问。

5. 配置数据读取者（DataReader）
- **读取者数据生命周期**：配置数据读取者如何处理数据实例的创建和删除。
- **读取者实例状态**：设置数据读取者如何处理数据实例的状态变化。
- **读取者样本状态**：配置数据读取者如何处理样本的状态，如读取或未读取。

配置方法
- **通过API设置**：DDS提供了一系列的API，允许应用程序在创建实体时或之后设置QoS策略。
- **使用QoS配置文件**：在某些DDS实现中，可以使用配置文件来定义QoS策略，然后在DDS启动时加载这些配置。
- **动态调整**：DDS允许在运行时动态调整某些QoS策略，以响应运行时条件的变化。

通过合理配置QoS策略，DDS实体可以适应不同的网络条件和应用需求，从而提供可靠、高效和可预测的数据分发服务。正确使用QoS策略对于优化DDS系统的性能和资源利用至关重要。
