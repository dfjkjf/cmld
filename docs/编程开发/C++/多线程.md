---
sort: 4
---

# C++多线程

1. 基本线程创建

要创建新线程，请包含 \<thread\> 头文件并创建将函数作为参数的 std::thread 实例。该函数将在新线程中执行。

```c++
#include <iostream>
#include <thread>

void my_function() {
    std::cout << "This function is executing in a separate thread" << std::endl;
}

int main() {
    std::thread t(my_function);
    t.join(); // waits for the thread to complete
    return 0;
}
```

您可以通过将参数作为附加参数提供给 std::thread 构造函数来将参数传递给线程函数。

```c++
#include <iostream>
#include <thread>

void print_sum(int a, int b) {
    std::cout << "The sum is: " << a + b << std::endl;
}

int main() {
    std::thread t(print_sum, 3, 5);
    t.join();
    return 0;
}
```

2. 互斥体和锁

当多个线程访问共享资源时，可能会出现数据竞争。为了避免这种情况，请使用互斥锁和锁来同步共享资源访问。
```c++
#include <iostream>
#include <mutex>
#include <thread>

std::mutex mtx;

void print_block(int n, char c) {
    {
        std::unique_lock<std::mutex> locker(mtx);
        for (int i = 0; i < n; ++i) {
            std::cout << c;
        }
        std::cout << std::endl;
    }
}

int main() {
    std::thread t1(print_block, 50, '*');
    std::thread t2(print_block, 50, '$');

    t1.join();
    t2.join();

    return 0;
}
```

原子操作